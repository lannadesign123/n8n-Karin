{"createdAt":"2025-07-10T14:47:35.221Z","updatedAt":"2025-07-10T14:49:27.980Z","id":"HFU523zdM9YjFIpC","name":"динамика изменений показаний кожи","active":false,"isArchived":false,"nodes":[{"parameters":{},"name":"AI Recommendation","type":"n8n-nodes-base.openai","typeVersion":1,"position":[1340,-400],"id":"792e50e7-420a-4d82-a469-1a30e9d7216c"},{"parameters":{"chatId":"={{$json[\"user_id\"]}}","text":"*Персональные рекомендации по уходу:*\n\n{{$json[\"text\"]}}","additionalFields":{"parse_mode":"Markdown"}},"name":"Send Recommendation","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1520,-220],"id":"993f6840-62a9-466a-bc7b-3c26f91d76c4","webhookId":"51a04263-1df4-41d7-8037-e18a09f80669","credentials":{"telegramApi":{"id":"3eWTvussnWeUqUM3","name":"Ai_K_Loo_cosmetologist"}}},{"parameters":{"chatId":"={{$json[\"chat_id\"]}}","text":"Введите данные с прибора в формате:\n\n💧 Влажность: XX\n🛢️ Жирность: XX\n📆 Возраст кожи: XX\n🧵 Упругость: XX","additionalFields":{}},"name":"Ask for Input1","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[120,-220],"id":"4ab1211a-48d8-42ad-a3af-c005194ad539","webhookId":"80ee7de8-a665-40e3-9e63-bfde8bf221b3"},{"parameters":{"functionCode":"const input = $json[\"message\"] || \"\";\nconst data = input.match(/\\d+/g);\nif (data.length !== 4) {\n  throw new Error(\"Неверный формат. Нужно 4 числовых значения.\");\n}\nreturn [\n  {\n    json: {\n      moisture: parseInt(data[0]),\n      oiliness: parseInt(data[1]),\n      skin_age: parseInt(data[2]),\n      elasticity: parseInt(data[3]),\n      date: new Date().toISOString().slice(0, 10),\n      user_id: $json[\"chat_id\"]\n    }\n  }\n];"},"name":"Parse Input1","type":"n8n-nodes-base.function","typeVersion":1,"position":[320,-220],"id":"e3d63ce6-e8b6-4438-a4cb-afc73d5a2b3e"},{"parameters":{"operation":"Insert"},"name":"Save to DB1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[520,-220],"id":"6cbb895c-d8f1-4bf8-9af9-6030ec7c870c","credentials":{"supabaseApi":{"id":"sgY0tFgUrMvTIz2b","name":"Supabase account"}}},{"parameters":{},"name":"Fetch Previous1","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[720,-220],"id":"89a2e48c-e73c-4e40-8596-55615d8024c4","credentials":{"supabaseApi":{"id":"sgY0tFgUrMvTIz2b","name":"Supabase account"}}},{"parameters":{"functionCode":"const current = items[0].json;\nconst history = items[1]?.json || {};\nlet result = \"\";\n\nif (history.moisture !== undefined) {\n  const diff = current.moisture - history.moisture;\n  result += `💧 Влажность: ${diff > 0 ? \"+\" : \"\"}${diff}%\\n`;\n}\nif (history.oiliness !== undefined) {\n  const diff = current.oiliness - history.oiliness;\n  result += `🛢️ Жирность: ${diff > 0 ? \"+\" : \"\"}${diff}%\\n`;\n}\nif (history.elasticity !== undefined) {\n  const diff = current.elasticity - history.elasticity;\n  result += `🧵 Упругость: ${diff > 0 ? \"+\" : \"\"}${diff}%\\n`;\n}\nif (history.skin_age !== undefined) {\n  const diff = current.skin_age - history.skin_age;\n  result += `📆 Возраст кожи: ${diff > 0 ? \"+\" : \"\"}${diff} лет\\n`;\n}\nreturn [{ json: { summary: result }}];"},"name":"Compare Data1","type":"n8n-nodes-base.function","typeVersion":1,"position":[920,-220],"id":"84393c30-7a90-49c8-86b7-33f6d3bde599"},{"parameters":{"chatId":"={{$json[\"user_id\"]}}","text":"Вот динамика изменений ваших показателей:\\n\\n{{$json[\"summary\"]}}","additionalFields":{}},"name":"Send Result1","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1120,-220],"id":"61ddb32d-8659-43b7-96b4-e7eab3b5f6fb","webhookId":"9abe444f-e60f-469c-8cea-8500b9a4eabf"}],"connections":{"Ask for Input1":{"main":[[{"node":"Parse Input1","type":"main","index":0}]]},"Parse Input1":{"main":[[{"node":"Save to DB1","type":"main","index":0}]]},"Save to DB1":{"main":[[{"node":"Fetch Previous1","type":"main","index":0}]]},"Fetch Previous1":{"main":[[{"node":"Compare Data1","type":"main","index":0}]]},"Compare Data1":{"main":[[{"node":"Send Result1","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"720dab3b-5047-42b8-aede-37f91974d014","triggerCount":0,"tags":[]}