{"createdAt":"2025-06-06T14:00:17.892Z","updatedAt":"2025-07-02T16:34:37.705Z","id":"tmPp2YkS3VzZdAqQ","name":"Ai cosmetologist","active":false,"isArchived":false,"nodes":[{"parameters":{"updates":["*"],"additionalFields":{}},"type":"n8n-nodes-base.telegramTrigger","typeVersion":1.2,"position":[-300,420],"id":"20707aca-62d6-47c3-b0f4-67a8e22efb1b","name":"Telegram Trigger","webhookId":"ded44252-4d0e-433a-9c1c-9a852f9ed86d","credentials":{"telegramApi":{"id":"CyAEGJdkxc0s0SqS","name":"tg Ai K.Loo cosmetologist"}}},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"0a73cab2-d78a-4354-a626-2fa054d2426a","leftValue":"={{ $json.message.text }}","rightValue":"/start","operator":{"type":"string","operation":"startsWith"}}],"combinator":"and"},"renameOutput":true,"outputKey":"start"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"8add6201-154f-48c0-a29a-d62636c8eeda","leftValue":"={{ $json.message.text }}","rightValue":"/cosmetics","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"renameOutput":true,"outputKey":"–ø–æ–¥–±–æ—Ä"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"84ed176e-27ae-417d-86d4-d3d936357288","leftValue":"","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"—Å–≤–æ–±–æ–¥–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[40,420],"id":"83f55bea-295e-4602-9c8a-a883f5bb79b6","name":"Switch"},{"parameters":{"content":"# /start  –ü–û–î–ë–û–†–ö–ê –£–•–û–î–ê /–ë–Æ–î–ñ–ï–¢\n\n\n\n","height":372,"width":1638,"color":7},"id":"d7316c7e-8958-4622-ae4b-c2334af9f2df","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[240,240],"typeVersion":1},{"parameters":{"operation":"sendPhoto","chatId":"={{ $('Switch').item.json.message.from.id }}","file":"https://i.postimg.cc/htYTg7ZR/sdfg.jpg","additionalFields":{"caption":"=*{{ $json.message.from.username }}, —è –±–µ–∑—É–º–Ω–æ —Ä–∞–¥–∞ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å!* üíå\n\n‚ú®–ï—Å–ª–∏ —Ç—ã –µ—â–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ –Ω–µ —Å–æ—Å—Ç–æ–∏—à—å –≤ _Beauty Club K.Loo_, –∑–Ω–∞—á–∏—Ç —Å–∞–º–æ–µ –≤—Ä–µ–º—è –≤—Å—Ç—É–ø–∏—Ç—å ‚û°Ô∏èhttps://t.me/beauty_s_karinoy, –≤–µ–¥—å  —Ç–µ–ø–µ—Ä—å —Ç–≤–æ–π —É—Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å! üí´ \n\nüß† *AI-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥ —É–∂–µ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ:*\n–û–Ω –±—É–¥–µ—Ç —Ä—è–¥–æ–º 24/7, —á—Ç–æ–±—ã –ø–æ–¥—Å–∫–∞–∑–∞—Ç—å, –ø–æ–¥–æ–±—Ä–∞—Ç—å –∏ –æ–±—ä—è—Å–Ω–∏—Ç—å –≤—Å—ë –æ —Ç–≤–æ–µ–π –∫–æ–∂–µ –∏ –∫–æ—Å–º–µ—Ç–∏–∫–µ.\n\nüéÅ *–ß—Ç–æ —Ç–µ–ø–µ—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–µ–±–µ:*\nüíé _–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–¥–±–æ—Ä–∫–∏ —É—Ö–æ–¥–æ–≤—ã—Ö —Å—Ä–µ–¥—Å—Ç–≤_\nüí¨ _–ü–æ–¥–¥–µ—Ä–∂–∫–∞ AI-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ —É—Ö–æ–¥–∞. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞–≤–∞—Ç—å –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è AI-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥—É._\nüåü _–¢—ã –ø–æ–ª—É—á–∏—à—å —Å–∫–∏–¥–∫–∏, –∞–∫—Ü–∏–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ç—Ä–µ–Ω–¥–∞–º_\nüí∏ _–†–æ–∑—ã–≥—Ä—ã—à–∏ –∫–æ—Å–º–µ—Ç–∏–∫–∏_\n\n\nüíñ –£—Ö–æ–¥ –∑–∞ —Å–æ–±–æ–π ‚Äî –Ω–µ —Ä–æ—Å–∫–æ—à—å, –∞ —Ñ–æ—Ä–º–∞ –ª—é–±–≤–∏ –∫ —Å–µ–±–µ. \n–°–µ–π—á–∞—Å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ —Ç–∞–∫–æ–π –ø—É—Ç—å.\n\nüëâ –ú–æ–∂–µ—à—å —Å—Ä–∞–∑—É –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –Ω–∞–∂–∞—Ç—å –≤ –º–µ–Ω—é /üß¥–ü–æ–¥–±–æ—Ä –∫–æ—Å–º–µ—Ç–∏–∫–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ—é –ø–µ—Ä–≤—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é.","parse_mode":"Markdown"}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[420,0],"id":"51d5f1dc-ad66-418d-940b-7706e8da3bff","name":"start","webhookId":"da4a8d3c-0d67-480c-a25d-4844309807d2","executeOnce":true,"credentials":{"telegramApi":{"id":"CyAEGJdkxc0s0SqS","name":"tg Ai K.Loo cosmetologist"}}},{"parameters":{"documentId":{"__rl":true,"value":"1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04","mode":"list","cachedResultName":"Ai K.Loo Beauty2","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ai K.Loo Beauty","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"user_name"},{"lookupColumn":"message_id"},{"lookupColumn":"chat_id"},{"lookupColumn":"skin_type"},{"lookupColumn":"budget"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1080,340],"id":"ef9db5f3-8825-4504-92b5-4908a930f751","name":"GET profile","credentials":{"googleSheetsOAuth2Api":{"id":"6vdQC6SPbqTKJEsT","name":"Google Sheets account"}}},{"parameters":{"chatId":"={{ $json.chat_id }}","text":"=‚ú® –¢–≤–æ—è –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ø–æ–¥–±–æ—Ä–∫–∞ —É—Ö–æ–¥–∞ –≥–æ—Ç–æ–≤–∞!\nüì¶ –ü–æ–¥–æ–±—Ä–∞–Ω–∞ —Å —É—á—ë—Ç–æ–º —Ç–≤–æ–µ–≥–æ —Ç–∏–ø–∞ –∫–æ–∂–∏ –∏ –±—é–¥–∂–µ—Ç–∞.\n\nüí¨ –•–æ—á–µ—à—å –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å AI-–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥—É?\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –≤ —á–∞—Ç–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É:\n/ (–≤–≤–µ–¥–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å)","replyMarkup":"forceReply","forceReply":{},"additionalFields":{}},"name":"Send Products to Telegram","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[2360,320],"id":"99195b17-ebfd-48d2-a1a9-d9986271e478","webhookId":"1aa4a16e-2b28-417a-be38-5b785433341e","executeOnce":true,"credentials":{"telegramApi":{"id":"CyAEGJdkxc0s0SqS","name":"tg Ai K.Loo cosmetologist"}}},{"parameters":{"promptType":"define","text":"=–ø–æ–∏—Å–∫ –∫–æ—Å–º–µ—Ç–∏–∫–∏ —Å —Å–∞–π—Ç–∞ https://goldapple.ru/","hasOutputParser":true,"options":{"systemMessage":"=You are an AI beauty consultant, an expert in cosmetology and dermatology. Communicate with users in a friendly, youthful tone ‚Äì like a friend who knows how to take care of her skin.\n\nüéØ Your task:\nPick 7 facial skincare products that suit the skin type {{ $json.skin_type }} and fit within the specified budget {{ $json.budget }} (in rubles).\n\nüìã –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã:\n1. üåü –¢–æ–Ω–µ—Ä  \n2. üíß –°—ã–≤–æ—Ä–æ—Ç–∫–∞  \n3. ‚òÄÔ∏è –î–Ω–µ–≤–Ω–æ–π –∫—Ä–µ–º  \n4. üåô –ù–æ—á–Ω–æ–π –∫—Ä–µ–º  \n5. üëÅÔ∏è –ö—Ä–µ–º –¥–ª—è –≥–ª–∞–∑  \n6. ‚òÄÔ∏è SPF  \n7. ‚ú® –ü–∏–ª–∏–Ω–≥ / —Å–∫—Ä–∞–±  \n\nüõçÔ∏è Use only the online store https://goldapple.ru/ ‚Äî search for real products on the site. Copy the actual product links and include them in the answer.\n\nüí∞ Calculate the total cost of all 7 products and specify whether it fits within the budget.\n\nüì¶ The answer must contain **exactly 7 products** (one per category) in Telegram Markdown format:\n\n‚ú® Here is a selection of the best facial skin care products suitable for your skin type and budget:\n\n  üåü *Product Name*  \n  üìã _Short description_  \n  üí∏ *Price*  \n  üîó Product link\n\n\n\nüßæ *Total:* XX RUB  \n‚úÖ Within budget: Yes/No\n\n‚ö†Ô∏è Do not give any additional tips or recommendations, strictly follow the task  \n‚ö†Ô∏è Always write in Russian  \n‚ö†Ô∏è Add emojis ‚Äì they make the text more lively and understandable\n"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[1340,320],"id":"344fa7e6-e3a3-40f1-8433-1e3ebe90b4a0","name":"Search Agent"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini","mode":"list","cachedResultName":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1160,660],"id":"06eb6be5-8b51-4484-bb21-d1357cdb72ef","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"pEYK630XicQCaEr8","name":"OpenAi account 2"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const sheetData = $json || {};\n\nconst chatId = sheetData.chat_id || 0;\nconst messageId = sheetData.message_id || 0;\nconst typeSkin = sheetData.skin_type || \"–∂–∏—Ä–Ω–∞—è\";\nconst budget = sheetData.budget || \"–Ω–µ —É–∫–∞–∑–∞–Ω\";\nconst raw = sheetData.Recomendation || \"\";\n\n// –ò—â–µ–º –ø–µ—Ä–≤—É—é markdown-—Å—Å—ã–ª–∫—É\nconst linkMatch = raw.match(/\\[.*?\\]\\((.*?)\\)/);\nconst link = linkMatch ? linkMatch[1] : \"\";\n\n// –£–¥–∞–ª—è–µ–º markdown, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç\nlet cleanText = raw.replace(/\\[([^\\]]+)\\]\\((.*?)\\)/g, '$1').trim();\n\n// –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∂–∏—Ä–Ω–æ–π (–¥–æ –ø–µ—Ä–≤–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä–æ–∫–∏)\ncleanText = cleanText.replace(/^(.+?)\\n/, '**$1**\\n');\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ\nlet text = cleanText.substring(0, 500);\n\nif (link) {\n  text += `\\n\\nüîó [–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–≤–∞—Ä—É](${link})`;\n}\n\ntext += `\\n\\nüí¨ –•–æ—á–µ—à—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —Å–æ–≤–µ—Ç—ã?`;\n\nreturn {\n  json: {\n    chat_id: chatId,\n    message_id: messageId,\n    type_skin: typeSkin,\n    text: text.substring(0, 4000),\n    parse_mode: \"Markdown\", // –¥–æ–±–∞–≤–∏–ª–∏ Markdown –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è\n    disable_web_page_preview: false,\n    reply_markup: {     inline_keyboard: [       [{ text: \"üíñ –ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å—å —Å–ø–∏—Å–æ–∫\", callback_data: \"pay_sub\" }],       [{ text: \"üîÅ –•–æ—á—É –ø–æ–∑–∂–µ\", callback_data: \"later\" }]     ]   }\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2080,320],"id":"3bf760af-054a-4da1-aa82-2cd005eaa99f","name":"Code3"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04","mode":"list","cachedResultName":"Ai K.Loo Beauty2","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ai K.Loo Beauty","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"chat_id":"={{ $('Google Sheets4').item.json.chat_id }}","Recomendation":"={{ $json.output }}","budget":"={{ $('Google Sheets4').item.json.budget }}"},"matchingColumns":["chat_id"],"schema":[{"id":"user_name","displayName":"user_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"message_id","displayName":"message_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"chat_id","displayName":"chat_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"skin_type","displayName":"skin_type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"budget","displayName":"budget","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Recomendation","displayName":"Recomendation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Photo","displayName":"Photo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1800,320],"id":"374e0d23-02ee-4330-aeca-c903e8ba401a","name":"Google Sheets6","credentials":{"googleSheetsOAuth2Api":{"id":"6vdQC6SPbqTKJEsT","name":"Google Sheets account"}}},{"parameters":{"toolDescription":"Use this tool to search the https://aravia.ru/","method":"POST","url":"https://api.firecrawl.dev/v1/scrape","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer fc-4a429c6f884e4b9a9eae1e7c8fdeaaac"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"url\": \"https://goldapple.ru/\",\n  \"formats\": [\n    \"markdown\",\n    \"html\"\n  ]\n}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1880,660],"id":"6c513dad-8b7b-42cb-b887-8bf328f1983e","name":"Firecrawl Search","credentials":{"httpHeaderAuth":{"id":"qviB60gv9EbG3cfx","name":"Header Auth account"}},"disabled":true},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1480,660],"id":"338a7748-a4fa-4d65-a522-e0a828f57645","name":"Calculator"},{"parameters":{"jsCode":"// –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å –∏–∑ Google Sheets1\nconst sheetData = $items(\"Google Sheets1\")[0].json;\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–∏–ø –∫–æ–∂–∏, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ —Å—Ç–∞–≤–∏–º \"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π\"\nconst skinType = sheetData[\"skin_type\"]?.trim() || \"–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π\";\n\n// –ü–æ–ª—É—á–∞–µ–º chat_id –∏ message_id\nconst chatId = sheetData[\"chat_id\"];\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—ã–±–æ—Ä–∞ –±—é–¥–∂–µ—Ç–∞\nreturn {\n  json: {\n    step: \"ask_budget\",\n    chat_id: chatId,\n    type_skin: skinType,\n    text: `üí∞–ö–∞–∫–æ–π —É —Ç–µ–±—è –±—é–¥–∂–µ—Ç –Ω–∞ —É—Ö–æ–¥–æ–≤—ã–π —Ç–æ–≤–∞—Ä –¥–ª—è —Ç–∏–ø–∞ –∫–æ–∂–∏ *${skinType}*?`,\n    reply_markup: {\n      inline_keyboard: [\n        [\n          { text: \"–¥–æ 800‚ÇΩ\", callback_data: \"budget_800\" },\n          { text: \"–¥–æ 1000‚ÇΩ\", callback_data: \"budget_1000\" }\n        ],\n        [\n          { text: \"–¥–æ 2000‚ÇΩ\", callback_data: \"budget_2000\" },\n          { text: \"–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π\", callback_data: \"budget_unlimited\" }\n        ]\n      ]\n    }\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[640,340],"id":"9b896ed3-ff1a-4614-b42a-14bff0df4adb","name":"–ë—é–¥–∂–µ—Ç"},{"parameters":{"chatId":"={{ $('Telegram Trigger').item.json.callback_query.message.chat.id }}","text":"={{ $json.text }}","replyMarkup":"inlineKeyboard","inlineKeyboard":{"rows":[{"row":{"buttons":[{"text":"–¥–æ 800‚ÇΩ","additionalFields":{"callback_data":"={{ $json.reply_markup.inline_keyboard[0][0].callback_data }}"}},{"text":"–¥–æ 1000‚ÇΩ","additionalFields":{"callback_data":"={{ $json.reply_markup.inline_keyboard[0][1].callback_data }}"}}]}},{"row":{"buttons":[{"text":"={{ $json.reply_markup.inline_keyboard[1][0].text }}","additionalFields":{"callback_data":"={{ $json.reply_markup.inline_keyboard[1][0].callback_data }}"}},{"text":"=ü§ë–ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π","additionalFields":{"callback_data":"={{ $json.reply_markup.inline_keyboard[1][1].callback_data }}"}}]}}]},"additionalFields":{"appendAttribution":false}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[860,340],"id":"afc994e7-4681-44e2-b0c5-3cdcef4119b8","name":"–ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä –±—é–¥–∂–µ—Ç–∞","webhookId":"182771d4-324c-4a5e-9b6b-cb35d00a0a98","credentials":{"telegramApi":{"id":"CyAEGJdkxc0s0SqS","name":"tg Ai K.Loo cosmetologist"}}},{"parameters":{"content":"# –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø","height":620,"width":1760,"color":3},"type":"n8n-nodes-base.stickyNote","position":[240,860],"typeVersion":1,"id":"7ef8c2c6-6db4-4750-9efc-dd02e9dbf3e3","name":"Sticky Note","disabled":true},{"parameters":{"chatId":"={{ $json.chat_id }}","text":"={{ $json.text }}","replyMarkup":"forceReply","forceReply":{},"additionalFields":{}},"name":"Send Products to Telegram1","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1740,1040],"id":"1b67a72d-f8ed-47fc-b4e8-6a097e50416c","webhookId":"1aa4a16e-2b28-417a-be38-5b785433341e","executeOnce":true,"credentials":{"telegramApi":{"id":"CyAEGJdkxc0s0SqS","name":"tg Ai K.Loo cosmetologist"}}},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04","mode":"list","cachedResultName":"Ai K.Loo Beauty2","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ai K.Loo Beauty","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1zeaY92vztlwUPhv1-omWhA9y3vq6hTpXRBHL93_i_04/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"user_name":"={{ $('Telegram Trigger').item.json.message.from.username }}","message_id":"={{ $('Telegram Trigger').item.json.message.message_id }}","chat_id":"={{ $('Telegram Trigger').item.json.message.chat.id }}","Recomendation":"={{ $json.output }}"},"matchingColumns":["user_name"],"schema":[{"id":"user_name","displayName":"user_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"message_id","displayName":"message_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"chat_id","displayName":"chat_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"skin_type","displayName":"skin_type","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"budget","displayName":"budget","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true},{"id":"Recomendation","displayName":"Recomendation","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Photo","displayName":"Photo","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[1080,1040],"id":"e25b237c-8ca0-4fcb-add3-82edda595e8e","name":"GET profile1","credentials":{"googleSheetsOAuth2Api":{"id":"6vdQC6SPbqTKJEsT","name":"Google Sheets account"}}},{"parameters":{"sessionIdType":"customKey","sessionKey":"\"skin_type\", \"user_preferences\""},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[640,1320],"id":"190537e2-d827-4eeb-94fd-7a700efe7b5c","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4.1-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[460,1300],"id":"2257ab64-d354-4ccf-8eb4-446d9568e862","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"pEYK630XicQCaEr8","name":"OpenAi account 2"}}},{"parameters":{"promptType":"define","text":"={{ $json.message.text }}","hasOutputParser":true,"options":{"systemMessage":"=***You are a professional and friendly AI-powered skincare consultant. You help users with skincare routine questions, beauty product recommendations, ingredient explanations, and solutions for common skin concerns like acne, dryness, oiliness, and pigmentation.\n\n***Your tone should always be warm, supportive, and clear ‚Äî speak like a caring expert, not a medical textbook. Use simple language.\n\nüîπ You only talk about skincare and beauty:\n- Skincare (skin types, acne, hydration, sensitivity, etc.)\n- Skincare tips, hacks, ingredient lists, and common mistakes.\n\n***Don't recommend cosmetics to the user, only advice and life hacks\n\n***If you mention ingredients (like niacinamide or salicylic acid), briefly explain what they do.\n\n***Always recommend products by type (e.g. cleanser, toner, serum, moisturizer) rather than brand names, and offer key ingredients that match the user's concerns.\n\n***‚ö†Ô∏è Important:\nAll responses must be written in **Russian**, regardless of the language in which the data is entered.\n\n***If a user's message is **not related to skincare or beauty**, politely inform them that you only answer questions on these topics.\n\n\n***Here are some examples of user questions you may receive:\n‚Äì I have acne, what should I do?\n‚Äì Which cream is best for dry skin?\n‚Äì I'm 40, how can I even out my skin tone?\n‚Äì Which is better, niacinamide or retinol?\n\nHere is an example of a message displayed to the user:\n(üß¥ –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–º–æ—á—å –ø—Ä–∏ –∞–∫–Ω–µ:\n–û—á–∏—â–µ–Ω–∏–µ (2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å):\n–ò—Å–ø–æ–ª—å–∑—É–π –º—è–≥–∫–∏–π –≥–µ–ª—å —Å —Å–∞–ª–∏—Ü–∏–ª–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç–æ–π –∏–ª–∏ —Ü–∏–Ω–∫–æ–º.\n–ü—Ä–∏–º–µ—Ä: –≥–µ–ª—å –¥–ª—è —É–º—ã–≤–∞–Ω–∏—è —Å —Å–∞–ª–∏—Ü–∏–ª–æ–≤–æ–π –∫–∏—Å–ª–æ—Ç–æ–π 1‚Äì2%.\n\n–¢–æ–Ω–∏–∫ –∏–ª–∏ —ç—Å—Å–µ–Ω—Ü–∏—è:\n–ë–µ–∑ —Å–ø–∏—Ä—Ç–∞! –ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥–æ–π–¥—ë—Ç —Å –Ω–∏–∞—Ü–∏–Ω–∞–º–∏–¥–æ–º –∏–ª–∏ —Ü–µ–Ω—Ç–µ–ª–ª–æ–π ‚Äî —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –∫–æ–∂—É –∏ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –∂–∏—Ä–Ω–æ—Å—Ç—å.\n\n–°—ã–≤–æ—Ä–æ—Ç–∫–∞/–ê–∫—Ç–∏–≤:\n‚ñ´Ô∏è –ù–∏–∞—Ü–∏–Ω–∞–º–∏–¥ (5‚Äì10%) ‚Äî —Å–Ω–∏–º–∞–µ—Ç –≤–æ—Å–ø–∞–ª–µ–Ω–∏–µ\n‚ñ´Ô∏è –ê–∑–µ–ª–∞–∏–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ ‚Äî –æ—Å–≤–µ—Ç–ª—è–µ—Ç –ø–æ—Å—Ç-–∞–∫–Ω–µ –∏ –±–æ—Ä–µ—Ç—Å—è —Å –±–∞–∫—Ç–µ—Ä–∏—è–º–∏\n‚ñ´Ô∏è –°–∞–ª–∏—Ü–∏–ª–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞ ‚Äî –æ—á–∏—â–∞–µ—Ç –ø–æ—Ä—ã\n\n–£–≤–ª–∞–∂–Ω–µ–Ω–∏–µ:\n–ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π! –õ—ë–≥–∫–∏–π –≥–µ–ª—å-–∫—Ä–µ–º –±–µ–∑ –º–∞—Å–µ–ª –ø–æ–º–æ–∂–µ—Ç —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∞—Ä—å–µ—Ä –∫–æ–∂–∏.\n\nSPF (—É—Ç—Ä–æ–º):\n–î–∞–∂–µ –ø—Ä–∏ –∞–∫–Ω–µ –Ω—É–∂–µ–Ω —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–π –∫—Ä–µ–º ‚Äî –≤—ã–±–∏—Ä–∞–π –±–µ–∑ –º–∞—Å–µ–ª, —Å –º–∞—Ç–∏—Ä—É—é—â–∏–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º.)\n\n***‚ö†Ô∏èAt the end of the answer, do not ask the user questions\n***‚ö†Ô∏è Always reply in **Russian**\n***‚ö†Ô∏è Always use **emoji** to make the text more vivid and understandable."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2,"position":[560,1040],"id":"d399dcd1-f8d1-4de7-b845-ea9b5e8bd93b","name":"Ai cosmetologist"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1320,660],"id":"9693d07d-6f66-46ad-ab57-0cecc2cecfd6","name":"Simple Memory1"},{"parameters":{"documentId":{"__rl":true,"value":"1Y4LNK4LOUFN5Wiz9hsTA54kzQ_dw36tSio17aOE8jNo","mode":"list","cachedResultName":"Ai K.Loo Beauty","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y4LNK4LOUFN5Wiz9hsTA54kzQ_dw36tSio17aOE8jNo/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Ai K.Loo Beauty","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1Y4LNK4LOUFN5Wiz9hsTA54kzQ_dw36tSio17aOE8jNo/edit#gid=0"},"filtersUI":{"values":[{"lookupColumn":"chat_id","lookupValue":"={{ $json.message.chat.id }}"}]},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.6,"position":[460,340],"id":"90fde4c4-c88c-49b5-8f68-174582d45597","name":"GET profile2","alwaysOutputData":true,"credentials":{"googleSheetsOAuth2Api":{"id":"6vdQC6SPbqTKJEsT","name":"Google Sheets account"}}},{"parameters":{"mode":"runOnceForEachItem","jsCode":"const sheetData = $json || {};\n\nconst chatId = sheetData.chat_id || 0;\nconst messageId = sheetData.message_id || 0;\nconst typeSkin = sheetData.skin_type || \"–∂–∏—Ä–Ω–∞—è\";\nconst budget = sheetData.budget || \"–Ω–µ —É–∫–∞–∑–∞–Ω\";\nconst raw = sheetData.Recomendation || \"\";\n\n// –£–¥–∞–ª—è–µ–º markdown-—Å—Å—ã–ª–∫–∏, –æ—Å—Ç–∞–≤–ª—è—è —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–π —Ç–µ–∫—Å—Ç\nlet cleanText = raw.replace(/\\[([^\\]]+)\\]\\((.*?)\\)/g, '$1').trim();\n\n// –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∂–∏—Ä–Ω–æ–π\ncleanText = cleanText.replace(/^(.+?)\\n/, '‚ú® *$1*\\n');\n\n// –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º (–µ—Å–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞)\ncleanText = cleanText\n  .replace(/(?<=^|\\n)(–¢–æ–Ω–µ—Ä|–ü–µ–Ω–∫–∞)/gi, 'üß¥ $1')\n  .replace(/(?<=^|\\n)(–°—ã–≤–æ—Ä–æ—Ç–∫–∞)/gi, 'üíß $1')\n  .replace(/(?<=^|\\n)(–ö—Ä–µ–º)/gi, '‚òÄÔ∏è $1')\n  .replace(/(?<=^|\\n)(–ù–æ—á–Ω–æ–π –∫—Ä–µ–º)/gi, 'üåô $1')\n  .replace(/(?<=^|\\n)(–ö—Ä–µ–º –¥–ª—è –≥–ª–∞–∑)/gi, 'üëÅÔ∏è $1')\n  .replace(/(?<=^|\\n)(SPF|–°–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–π –∫—Ä–µ–º)/gi, 'üõ°Ô∏è $1')\n  .replace(/(?<=^|\\n)(–ü–∏–ª–∏–Ω–≥|–°–∫—Ä–∞–±)/gi, '‚ú® $1')\n  .replace(/(?<=^|\\n)(–û—á–∏—â–µ–Ω–∏–µ|–ö–ª–∏–Ω–∑–µ—Ä)/gi, 'üßº $1')\n  .replace(/(?<=^|\\n)(–£–≤–ª–∞–∂–Ω–µ–Ω–∏–µ|–£–≤–ª–∞–∂–Ω—è—é—â–∏–π –∫—Ä–µ–º)/gi, 'üí¶ $1')\n  .replace(/(?<=^|\\n)(–°–æ—Å—Ç–∞–≤|–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã)/gi, 'üß™ $1')\n  .replace(/(?<=^|\\n)(–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞)/gi, 'üßæ $1')\n  .replace(/(?<=^|\\n)(–£–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤ –±—é–¥–∂–µ—Ç)/gi, '‚úÖ $1');\n\n\n// –£—Å–µ—á–µ–Ω–∏–µ –¥–æ –ª–∏–º–∏—Ç–∞ Telegram (4000 —Å–∏–º–≤–æ–ª–æ–≤)\nconst text = cleanText.substring(0, 4000);\n\nreturn {\n  json: {\n    chat_id: chatId,\n    message_id: messageId,\n    type_skin: typeSkin,\n    text: text,\n    parse_mode: \"Markdown\",\n    disable_web_page_preview: false\n  }\n};\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1460,1040],"id":"0aa55322-de44-4371-b18f-6c3b9ee3396c","name":"Code"},{"parameters":{"method":"POST","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('URL', ``, 'string') }}","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[1640,660],"id":"4b54b67c-d050-4ebd-9456-378071b3cf2d","name":"HTTP Request1"}],"connections":{"Switch":{"main":[[{"node":"start","type":"main","index":0}],[{"node":"GET profile2","type":"main","index":0}],[{"node":"Ai cosmetologist","type":"main","index":0}]]},"GET profile":{"main":[[{"node":"Search Agent","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Search Agent":{"main":[[{"node":"Google Sheets6","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Search Agent","type":"ai_languageModel","index":0}]]},"Code3":{"main":[[{"node":"Send Products to Telegram","type":"main","index":0}]]},"Google Sheets6":{"main":[[{"node":"Code3","type":"main","index":0}]]},"Firecrawl Search":{"ai_tool":[[]]},"Calculator":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]},"–ë—é–¥–∂–µ—Ç":{"main":[[{"node":"–ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä –±—é–¥–∂–µ—Ç–∞","type":"main","index":0}]]},"start":{"main":[[]]},"–ö–Ω–æ–ø–∫–∏ –≤—ã–±–æ—Ä –±—é–¥–∂–µ—Ç–∞":{"main":[[{"node":"GET profile","type":"main","index":0}]]},"GET profile1":{"main":[[{"node":"Code","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Ai cosmetologist","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Ai cosmetologist","type":"ai_languageModel","index":0}]]},"Ai cosmetologist":{"main":[[{"node":"GET profile1","type":"main","index":0}]]},"Simple Memory1":{"ai_memory":[[{"node":"Search Agent","type":"ai_memory","index":0}]]},"GET profile2":{"main":[[{"node":"–ë—é–¥–∂–µ—Ç","type":"main","index":0}]]},"Code":{"main":[[{"node":"Send Products to Telegram1","type":"main","index":0}]]},"HTTP Request1":{"ai_tool":[[{"node":"Search Agent","type":"ai_tool","index":0}]]}},"settings":{"executionOrder":"v1","saveExecutionProgress":true,"callerPolicy":"workflowsFromSameOwner"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"bd58e112-b871-4194-9bf4-1db62b14a18f","triggerCount":0,"tags":[]}